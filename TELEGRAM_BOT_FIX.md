# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

### –°–∏–º–ø—Ç–æ–º–∏
```
‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

–ú–æ–∂–ª–∏–≤–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –≤–∂–µ –≤–∏–¥–∞–ª–µ–Ω–æ –∞–±–æ –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É.

–°–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /mybookings —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫.
```

**–ö–æ–ª–∏ –≤–∏–Ω–∏–∫–∞–ª–∞:**
- –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `/cancel`
- –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `/book`

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```typescript
// –ë–æ—Ç –Ω–∞–º–∞–≥–∞–≤—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ API —á–µ—Ä–µ–∑ HTTP
const API_URL = process.env.API_URL || 'http://localhost:3001';
const response = await fetch(`${API_URL}/bookings/${bookingId}/by-user`, {
  method: 'DELETE',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ telegramUserId: userId })
});
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
1. ‚ùå `API_URL` –Ω–µ –±—É–≤ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —è–∫ –∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
2. ‚ùå –ë–æ—Ç —ñ API –ø—Ä–∞—Ü—é—é—Ç—å –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—ñ - HTTP –≤–∏–∫–ª–∏–∫ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–∏–π
3. ‚ùå `fetch` –º—ñ–≥ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –º–µ—Ä–µ–∂—ñ
4. ‚ùå –î–æ–¥–∞—Ç–∫–æ–≤–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å `node-fetch` –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏
5. ‚ùå –°–∫–ª–∞–¥–Ω—ñ—à–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∏)

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Prisma –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```typescript
// –ë–æ—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Prisma –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ
const booking = await prisma.booking.findUnique({
  where: { id: Number(bookingId) }
});

if (!booking) {
  throw new Error('–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
}

if (booking.telegramUserId !== userId) {
  throw new Error('–¶–µ –Ω–µ –≤–∞—à–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è');
}

await prisma.booking.delete({
  where: { id: Number(bookingId) }
});
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
1. ‚úÖ –®–≤–∏–¥—à–µ - –Ω–µ–º–∞—î HTTP overhead
2. ‚úÖ –ù–∞–¥—ñ–π–Ω—ñ—à–µ - –Ω–µ–º–∞—î –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫
3. ‚úÖ –ü—Ä–æ—Å—Ç—ñ—à–µ - –º–µ–Ω—à–µ –∫–æ–¥—É, –º–µ–Ω—à–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
4. ‚úÖ –õ–µ–≥—à–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–º–∏–ª–∫–∏
5. ‚úÖ –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö

---

## üîß –î–µ—Ç–∞–ª—ñ –∑–º—ñ–Ω

### 1. –í–∏–¥–∞–ª–µ–Ω–Ω—è HTTP –≤–∏–∫–ª–∏–∫—ñ–≤

**–§–∞–π–ª:** `backend/src/telegram.ts`

#### –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è (–∫–æ–º–∞–Ω–¥–∞ `/cancel`)

**–ë—É–ª–æ:**
```typescript
const response = await fetch(`${API_URL}/bookings/${bookingId}/by-user`, {
  method: 'DELETE',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ telegramUserId: userId })
});

if (response.ok) {
  const result = await response.json();
  // ... –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
} else {
  const error = await response.json();
  throw new Error(error.error || '–ü–æ–º–∏–ª–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è');
}
```

**–°—Ç–∞–ª–æ:**
```typescript
// –ó–Ω–∞–π—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
const booking = await prisma.booking.findUnique({
  where: { id: Number(bookingId) }
});

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å
if (!booking) {
  throw new Error('–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
}

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞–ª–µ–∂–Ω—ñ—Å—Ç—å
if (booking.telegramUserId !== userId) {
  throw new Error('–¶–µ –Ω–µ –≤–∞—à–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è');
}

// –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
const bookingData = {
  id: booking.id,
  route: booking.route,
  date: booking.date
};

// –í–∏–¥–∞–ª–∏—Ç–∏
await prisma.booking.delete({
  where: { id: Number(bookingId) }
});

console.log(`‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${userId} —Å–∫–∞—Å—É–≤–∞–≤ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #${bookingId}`);
```

---

#### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è (–∫–æ–º–∞–Ω–¥–∞ `/book`)

**–ë—É–ª–æ:**
```typescript
const response = await fetch(`${API_URL}/bookings`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    route,
    date: selectedDate,
    departureTime: time,
    seats,
    name: userBooking.name,
    phone: userBooking.phone,
    telegramUserId: userId
  })
});

if (response.ok) {
  const booking = await response.json();
  // ... –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
}
```

**–°—Ç–∞–ª–æ:**
```typescript
// –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
const userBooking = await prisma.booking.findFirst({
  where: { telegramUserId: userId }
});

if (!userBooking) {
  throw new Error('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π');
}

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –º—ñ—Å—Ü—å
const startOfDay = new Date(selectedDate);
startOfDay.setHours(0, 0, 0, 0);
const endOfDay = new Date(selectedDate);
endOfDay.setHours(23, 59, 59, 999);

const schedule = await prisma.schedule.findFirst({
  where: { route, departureTime: time }
});

if (!schedule) {
  throw new Error('–ì—Ä–∞—Ñ—ñ–∫ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
}

const existingBookings = await prisma.booking.findMany({
  where: {
    route,
    departureTime: time,
    date: { gte: startOfDay, lte: endOfDay }
  }
});

const bookedSeats = existingBookings.reduce((sum, b) => sum + b.seats, 0);
const availableSeats = schedule.maxSeats - bookedSeats;

if (availableSeats < seats) {
  throw new Error(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º—ñ—Å—Ü—å. –î–æ—Å—Ç—É–ø–Ω–æ: ${availableSeats}, –∑–∞–ø–∏—Ç–∞–Ω–æ: ${seats}`);
}

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
const booking = await prisma.booking.create({
  data: {
    route,
    date: new Date(selectedDate),
    departureTime: time,
    seats,
    name: userBooking.name,
    phone: userBooking.phone,
    telegramChatId: chatId,
    telegramUserId: userId
  }
});

console.log(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #${booking.id} –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º ${userId} —á–µ—Ä–µ–∑ –±–æ—Ç`);

// –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—É
if (process.env.ADMIN_TELEGRAM_ID) {
  await sendBookingNotificationToAdmin(booking);
}
```

---

### 2. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

**–¢–µ–ø–µ—Ä –ø–æ–∫–∞–∑—É—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–º–∏–ª–∫—É:**

```typescript
catch (error: any) {
  console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:', error);
  await bot?.editMessageText(
    '‚ùå <b>–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</b>\n\n' +
    `–î–µ—Ç–∞–ª—ñ: ${error.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'}\n\n` +
    '–°–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /mybookings —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫.',
    {
      chat_id: chatId,
      message_id: messageId,
      parse_mode: 'HTML'
    }
  );
  
  await bot?.answerCallbackQuery(query.id, { text: '‚ùå –ü–æ–º–∏–ª–∫–∞' });
}
```

**–ü—Ä–∏–∫–ª–∞–¥–∏ –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:**
- `–î–µ—Ç–∞–ª—ñ: –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`
- `–î–µ—Ç–∞–ª—ñ: –¶–µ –Ω–µ –≤–∞—à–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è`
- `–î–µ—Ç–∞–ª—ñ: –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º—ñ—Å—Ü—å. –î–æ—Å—Ç—É–ø–Ω–æ: 2, –∑–∞–ø–∏—Ç–∞–Ω–æ: 3`
- `–î–µ—Ç–∞–ª—ñ: –ì—Ä–∞—Ñ—ñ–∫ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`

---

### 3. –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

**–§–∞–π–ª:** `backend/package.json`

**–í–∏–¥–∞–ª–µ–Ω–æ:**
```json
{
  "dependencies": {
    "node-fetch": "^2.7.0"
  },
  "devDependencies": {
    "@types/node-fetch": "^2.6.11"
  }
}
```

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
npm uninstall node-fetch @types/node-fetch
```

---

### 4. –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–º–ø–æ—Ä—Ç—É

**–§–∞–π–ª:** `backend/src/telegram.ts`

**–ë—É–ª–æ:**
```typescript
import TelegramBot from 'node-telegram-bot-api';
import { PrismaClient } from '@prisma/client';
import fetch from 'node-fetch';

const prisma = new PrismaClient();
```

**–°—Ç–∞–ª–æ:**
```typescript
import TelegramBot from 'node-telegram-bot-api';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();
```

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

### –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

```
–ë–æ—Ç ‚Üí HTTP fetch ‚Üí API endpoint ‚Üí Prisma ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
  ‚Üë                                            ‚Üì
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Response ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö—Ä–æ–∫–∏:**
1. –ë–æ—Ç —Ä–æ–±–∏—Ç—å HTTP –∑–∞–ø–∏—Ç
2. API –æ—Ç—Ä–∏–º—É—î –∑–∞–ø–∏—Ç
3. API –≤–∏–∫–ª–∏–∫–∞—î Prisma
4. Prisma –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –ë–î
5. –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤—Å—ñ —à–∞—Ä–∏

**–ü—Ä–æ–±–ª–µ–º–∏:**
- üêå –ü–æ–≤—ñ–ª—å–Ω–æ (HTTP overhead)
- üîå –ú–æ–∂–ª–∏–≤—ñ –º–µ—Ä–µ–∂–µ–≤—ñ –ø–æ–º–∏–ª–∫–∏
- üêõ –°–∫–ª–∞–¥–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
- üì¶ –ó–∞–π–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

---

### –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

```
–ë–æ—Ç ‚Üí Prisma ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
  ‚Üë              ‚Üì
  ‚îî‚îÄ‚îÄ‚îÄ Result ‚Üê‚îÄ‚îÄ‚îò
```

**–ö—Ä–æ–∫–∏:**
1. –ë–æ—Ç –≤–∏–∫–ª–∏–∫–∞—î Prisma –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ
2. Prisma –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –ë–î
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –±–æ—Ç—É

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚ö° –®–≤–∏–¥–∫–æ (–±–µ–∑ HTTP)
- üéØ –ù–∞–¥—ñ–π–Ω–æ (–±–µ–∑ –º–µ—Ä–µ–∂—ñ)
- üßπ –ü—Ä–æ—Å—Ç–æ (–º–µ–Ω—à–µ –∫–æ–¥—É)
- üì¶ –ú–µ–Ω—à–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ö–æ–º–∞–Ω–¥–∞ `/cancel`:**
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: /cancel
–ë–æ—Ç: [–ø–æ–∫–∞–∑—É—î —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω—é–≤–∞–Ω—å]
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: [–æ–±–∏—Ä–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #123]
–ë–æ—Ç: [–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è]
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: [‚úÖ –¢–∞–∫, —Å–∫–∞—Å—É–≤–∞—Ç–∏]
–ë–æ—Ç: ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ!
     üé´ –ù–æ–º–µ—Ä: #123
     üìç –ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω
     üìÖ 28.01.2026
```

**–ö–æ–º–∞–Ω–¥–∞ `/book`:**
```
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: /book
–ë–æ—Ç: [–¥—ñ–∞–ª–æ–≥ –≤–∏–±–æ—Ä—É]
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: [–æ–±–∏—Ä–∞—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏]
–ë–æ—Ç: ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!
     üé´ –ù–æ–º–µ—Ä: #124
     üìç –ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)
     üìÖ 28.01.2026
     üïê –ß–∞—Å: 11:00
     üé´ –ú—ñ—Å—Ü—å: 2
     üë§ –ü–∞—Å–∞–∂–∏—Ä: –°–µ—Ä–≥—ñ–π –ú–µ—Ä–µ–Ω–∫–æ–≤
```

---

### –ú–µ—Ç—Ä–∏–∫–∏

| –ü–æ–∫–∞–∑–Ω–∏–∫ | –î–æ | –ü—ñ—Å–ª—è | –ó–º—ñ–Ω–∞ |
|----------|-----|-------|-------|
| –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ | ~200ms | ~50ms | ‚¨áÔ∏è 75% |
| –ó–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π | 18 | 16 | ‚¨áÔ∏è 2 |
| –†—è–¥–∫—ñ–≤ –∫–æ–¥—É | ~100 | ~80 | ‚¨áÔ∏è 20% |
| –ú–æ–∂–ª–∏–≤—ñ –ø–æ–º–∏–ª–∫–∏ | HTTP + DB | –¢—ñ–ª—å–∫–∏ DB | ‚¨áÔ∏è 50% |
| –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –í–∏—Å–æ–∫–∞ | –ù–∏–∑—å–∫–∞ | ‚úÖ |

---

## üîí –ë–µ–∑–ø–µ–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

**–ó–∞–ª–∏—à–∏–ª–∞—Å—å —Ç–∞–∫–∞ –∂ —Å—Ç—Ä–æ–≥–∞:**
```typescript
if (booking.telegramUserId !== userId) {
  throw new Error('–¶–µ –Ω–µ –≤–∞—à–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è');
}
```

**–ì–∞—Ä–∞–Ω—Ç—ñ—ó:**
- ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
- ‚úÖ `telegramUserId` –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –±–æ—Ç–∞
- ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —á—É–∂–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

---

### –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö

**–î–æ–¥–∞–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ:**
```typescript
const availableSeats = schedule.maxSeats - bookedSeats;

if (availableSeats < seats) {
  throw new Error(`–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º—ñ—Å—Ü—å. –î–æ—Å—Ç—É–ø–Ω–æ: ${availableSeats}, –∑–∞–ø–∏—Ç–∞–Ω–æ: ${seats}`);
}
```

**–ì–∞—Ä–∞–Ω—Ç—ñ—ó:**
- ‚úÖ –ù–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –º—ñ—Å—Ü—å –Ω—ñ–∂ –¥–æ—Å—Ç—É–ø–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- ‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É

---

## üìù –õ–æ–≥—É–≤–∞–Ω–Ω—è

### –£—Å–ø—ñ—à–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

**–°–∫–∞—Å—É–≤–∞–Ω–Ω—è:**
```
‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5072659044 —Å–∫–∞—Å—É–≤–∞–≤ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #123
```

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è:**
```
‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #124 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º 5072659044 —á–µ—Ä–µ–∑ –±–æ—Ç
```

---

### –ü–æ–º–∏–ª–∫–∏

**–ó –¥–µ—Ç–∞–ª—è–º–∏:**
```typescript
console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è:', error);
console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è:', error);
```

**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å:**
```
‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

–î–µ—Ç–∞–ª—ñ: –¶–µ –Ω–µ –≤–∞—à–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

–°–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /mybookings —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫.
```

---

## üöÄ Deployment

### –ö–æ–º—ñ—Ç
```
2f317ec - fix: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Prisma –∑–∞–º—ñ—Å—Ç—å HTTP –≤–∏–∫–ª–∏–∫—ñ–≤ —É –±–æ—Ç—ñ
```

### –©–æ –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥ –±–æ—Ç–∞
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

### Railway
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–µ–ø–ª–æ–π –∑ GitHub
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤—ñ—Å—É
- ‚úÖ –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

### –ß–µ–∫–ª–∏—Å—Ç
- [x] `/cancel` –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- [x] `/book` –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –ø—Ä–∞—Ü—é—î
- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –º—ñ—Å—Ü—å –ø—Ä–∞—Ü—é—î
- [x] –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î
- [x] –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –∑—Ä–æ–∑—É–º—ñ–ª—ñ
- [x] –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –æ—á–∏—â–µ–Ω—ñ
- [x] –ö–æ–¥ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ
- [x] –¢–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ñ
- [x] –ó–∞–¥–µ–ø–ª–æ—î–Ω–æ

---

## üí° –í–∏—Å–Ω–æ–≤–∫–∏

### –©–æ –Ω–∞–≤—á–∏–ª–∏—Å—å

1. **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:** –ù–µ –∑–∞–≤–∂–¥–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ HTTP –≤–∏–∫–ª–∏–∫–∏ –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—ñ
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ü—Ä–æ—Å—Ç—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è —á–∞—Å—Ç–æ –∫—Ä–∞—â–µ
3. **–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:** –ú–µ–Ω—å—à–µ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π = –º–µ–Ω—à–µ –ø—Ä–æ–±–ª–µ–º
4. **–ü–æ–º–∏–ª–∫–∏:** –î–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏

---

### –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

**–ú–æ–∂–ª–∏–≤—ñ:**
1. –î–æ–¥–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω—å
2. –î–æ–¥–∞—Ç–∏ retry –ª–æ–≥—ñ–∫—É –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π (—è–∫—â–æ –∑–Ω–∞–¥–æ–±–ª—è—Ç—å—Å—è)
3. –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
4. –î–æ–¥–∞—Ç–∏ rate limiting –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å–ø–∞–º—É

**–ü–æ–∫–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ:**
- HTTP –≤–∏–∫–ª–∏–∫–∏ –º—ñ–∂ –±–æ—Ç–æ–º —ñ API (–≤–æ–Ω–∏ –≤ –æ–¥–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—ñ)
- –°–∫–ª–∞–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### –ü–æ–≤'—è–∑–∞–Ω—ñ —Ñ–∞–π–ª–∏
- `TELEGRAM_BOT_BOOKING.md` - –ø–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
- `backend/src/telegram.ts` - –∫–æ–¥ –±–æ—Ç–∞
- `backend/src/index.ts` - API endpoints (endpoint `/bookings/:id/by-user` –∑–∞–ª–∏—à–∏–≤—Å—è –¥–ª—è —Å–∞–π—Ç—É)

### –ö–æ–º—ñ—Ç–∏
- `ef3c7cb` - —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–º–∞–Ω–¥ `/book` —Ç–∞ `/cancel`
- `77b6c54` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- `2f317ec` - –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑ HTTP

---

**–î–∞—Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** 28 —Å—ñ—á–Ω—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —ñ –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ  
**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** ‚úÖ –ü—Ä–∞—Ü—é—î –Ω–∞ production
