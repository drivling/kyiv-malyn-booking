# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∑–∞–ø–ª–∞—Ç–∫–∞ –≤ –∫–æ–º–∞–Ω–¥—ñ /mybookings

## üéØ –Ü–¥–µ—è

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π endpoint `/admin/fix-telegram-ids`, –∫–æ–º–∞–Ω–¥–∞ `/mybookings` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª—è—î —Å—Ç–∞—Ä—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

---

## üîß –Ø–∫ –ø—Ä–∞—Ü—é—î

### –ê–ª–≥–æ—Ä–∏—Ç–º:

```mermaid
graph TD
    A[–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: /mybookings] --> B[–ó–Ω–∞–π—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –ø–æ telegramUserId]
    B --> C{–ó–Ω–∞–π–¥–µ–Ω–æ —Ö–æ—á–∞ –± 1?}
    C -->|–¢–∞–∫| D[–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –Ω–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤]
    C -->|–ù—ñ| Z[–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –Ω–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å]
    D --> E[–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞...]
    E --> F[–ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–æ–º–µ—Ä]
    F --> G[–®—É–∫–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ userId=null]
    G --> H{–ó–Ω–∞–π–¥–µ–Ω–æ?}
    H -->|–¢–∞–∫| I[–û–Ω–æ–≤–∏—Ç–∏: userId + chatId]
    H -->|–ù—ñ| J[–ù–∞—Å—Ç—É–ø–Ω–∏–π –Ω–æ–º–µ—Ä]
    I --> K[–õ–æ–≥—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è]
    K --> J
    J --> L[–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è]
    L --> M[–ü–æ–∫–∞–∑–∞—Ç–∏ –º–∞–π–±—É—Ç–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è]
```

---

## üìù –ö–æ–¥

### –ú—ñ—Å—Ü–µ –≤ –∫–æ–¥—ñ: `backend/src/telegram.ts` ‚Üí –∫–æ–º–∞–Ω–¥–∞ `/mybookings`

```typescript
// –ü—ñ—Å–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
if (allUserBookings.length > 0) {
  // üîß –ó–ê–ü–õ–ê–¢–ö–ê: –®—É–∫–∞—î–º–æ —ñ–Ω—à—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ç–∞–∫–∏–º –∂–µ –Ω–æ–º–µ—Ä–æ–º
  
  // 1. –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤
  const userPhones = [...new Set(allUserBookings.map(b => b.phone))];
  console.log(`üì± –ù–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ${userPhones.join(', ')}`);
  
  // 2. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —à—É–∫–∞—î–º–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –±–µ–∑ telegramUserId
  for (const phone of userPhones) {
    const normalizedPhone = normalizePhone(phone);
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ "—Å–∏—Ä—ñ—Ç—Å—å–∫—ñ" –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
    const allBookingsForPhone = await prisma.booking.findMany({
      where: {
        OR: [
          { telegramUserId: null },
          { telegramUserId: '0' },
          { telegramUserId: '' }
        ]
      }
    });
    
    // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
    const orphanedBookings = allBookingsForPhone.filter(b => 
      normalizePhone(b.phone) === normalizedPhone
    );
    
    // 3. –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–∂–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
    if (orphanedBookings.length > 0) {
      for (const booking of orphanedBookings) {
        await prisma.booking.update({
          where: { id: booking.id },
          data: { 
            telegramUserId: userId,
            telegramChatId: chatId
          }
        });
        console.log(`‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #${booking.id} –æ–Ω–æ–≤–ª–µ–Ω–æ`);
      }
    }
  }
  
  // 4. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—Å—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
  const updatedAllBookings = await prisma.booking.findMany({
    where: { telegramUserId: userId },
    orderBy: { date: 'desc' }
  });
}
```

---

## üé¨ –ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏

### –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –ë–î:

| ID | Phone | telegramUserId | telegramChatId | Date |
|----|-------|----------------|----------------|------|
| 40 | +380501234567 | 5072659044 ‚úÖ | 5072659044 ‚úÖ | 2026-01-28 |
| 35 | 0501234567 | null ‚ùå | null ‚ùå | 2026-01-30 |
| 30 | +38(050)123-45-67 | 0 ‚ùå | 5072659044 | 2026-02-01 |
| 25 | 380501234567 | null ‚ùå | null ‚ùå | 2026-02-05 |

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î 4 –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è, –∞–ª–µ `/mybookings` –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ #40

---

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–æ–Ω—É—î: `/mybookings`

**–õ–æ–≥–∏ –Ω–∞ Railway:**

```
üîç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5072659044 –º–∞—î 1 –±—Ä–æ–Ω—é–≤–∞–Ω—å (–≤—Å—å–æ–≥–æ)
  - Booking #40: 2026-01-28 (telegramChatId: 5072659044)
üîß –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —ñ–Ω—à—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ç–∞–∫–∏–º –∂–µ –Ω–æ–º–µ—Ä–æ–º –±–µ–∑ telegramUserId...
üì± –ù–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: +380501234567
üîß –ó–Ω–∞–π–¥–µ–Ω–æ 3 –±—Ä–æ–Ω—é–≤–∞–Ω—å –∑ –Ω–æ–º–µ—Ä–æ–º +380501234567 –±–µ–∑ telegramUserId
  ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #35 –æ–Ω–æ–≤–ª–µ–Ω–æ: userId=5072659044, chatId=5072659044
  ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #30 –æ–Ω–æ–≤–ª–µ–Ω–æ: userId=5072659044, chatId=5072659044
  ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #25 –æ–Ω–æ–≤–ª–µ–Ω–æ: userId=5072659044, chatId=5072659044
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–≤'—è–∑–∞–Ω–æ 3 —Å—Ç–∞—Ä–∏—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 5072659044
üìä –ü—ñ—Å–ª—è –∑–∞–ø–ª–∞—Ç–∫–∏: 4 –±—Ä–æ–Ω—é–≤–∞–Ω—å (+3)
üìÖ –ú–∞–π–±—É—Ç–Ω—ñ—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å: 4 (–≤—ñ–¥ 2026-01-28)
‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5072659044 –ø–µ—Ä–µ–≥–ª—è–Ω—É–≤ —Å–≤–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è (–º–∞–π–±—É—Ç–Ω—ñ—Ö: 4)
```

---

### –í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É:

```
üìã –í–∞—à—ñ –º–∞–π–±—É—Ç–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è:

1. üé´ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #40
   üöå –ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)
   üìÖ 28.01.2026 –æ 11:00
   üé´ –ú—ñ—Å—Ü—å: 1
   üë§ –ü–∞—Å–∞–∂–∏—Ä: –°–µ—Ä–≥—ñ–π

2. üé´ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #35
   üöå –ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)
   üìÖ 30.01.2026 –æ 14:00
   üé´ –ú—ñ—Å—Ü—å: 2
   üë§ –ü–∞—Å–∞–∂–∏—Ä: –°–µ—Ä–≥—ñ–π

3. üé´ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #30
   üöå –ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤
   üìÖ 01.02.2026 –æ 08:00
   üé´ –ú—ñ—Å—Ü—å: 1
   üë§ –ü–∞—Å–∞–∂–∏—Ä: –°–µ—Ä–≥—ñ–π

4. üé´ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #25
   üöå –ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω
   üìÖ 05.02.2026 –æ 16:00
   üé´ –ú—ñ—Å—Ü—å: 3
   üë§ –ü–∞—Å–∞–∂–∏—Ä: –°–µ—Ä–≥—ñ–π

üîí –ü–æ–∫–∞–∑–∞–Ω–æ —Ç—ñ–ª—å–∫–∏ –≤–∞—à—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å—ñ 4 –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è! ‚úÖ

---

### –°—Ç–∞–Ω –ë–î –ø—ñ—Å–ª—è `/mybookings`:

| ID | Phone | telegramUserId | telegramChatId | Date |
|----|-------|----------------|----------------|------|
| 40 | +380501234567 | 5072659044 ‚úÖ | 5072659044 ‚úÖ | 2026-01-28 |
| 35 | 0501234567 | 5072659044 ‚úÖ | 5072659044 ‚úÖ | 2026-01-30 |
| 30 | +38(050)123-45-67 | 5072659044 ‚úÖ | 5072659044 ‚úÖ | 2026-02-01 |
| 25 | 380501234567 | 5072659044 ‚úÖ | 5072659044 ‚úÖ | 2026-02-05 |

**–í—Å—ñ –∑–∞–ø–∏—Å–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ!** üéâ

---

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ—Å—Ç—å ‚úÖ
- –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π endpoint
- –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω admin token
- –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### 2. –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å üîç
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –ø–æ–º—ñ—á–∞—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- –í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è "–Ω–∞ –ª—å–æ—Ç—É"
- –û–¥—Ä–∞–∑—É –±–∞—á–∏—Ç—å –≤—Å—ñ —Å–≤–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

### 3. –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è üì±
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–æ–º–µ—Ä–∏ —É –±—É–¥—å-—è–∫–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ:
  - `+380501234567`
  - `380501234567`
  - `0501234567`
  - `+38(050)123-45-67`
  - `050 123 45 67`

### 4. –ë–µ–∑–ø–µ–∫–∞ üîí
- –û–Ω–æ–≤–ª—é—î —Ç—ñ–ª—å–∫–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ç–∞–∫–∏–º –∂–µ –Ω–æ–º–µ—Ä–æ–º
- –ù–µ —Ç–æ—Ä–∫–∞—î—Ç—å—Å—è –±—Ä–æ–Ω—é–≤–∞–Ω—å —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ó–±–µ—Ä—ñ–≥–∞—î —ñ—Å—Ç–æ—Ä—ñ—é –≤ –ª–æ–≥–∞—Ö

### 5. –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å üîÑ
- –ú–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –±–∞–≥–∞—Ç–æ —Ä–∞–∑—ñ–≤
- –ù–µ —Å—Ç–≤–æ—Ä—é—î –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
- –ù–µ –ª–∞–º–∞—î —ñ—Å–Ω—É—é—á—ñ –ø—Ä–∏–≤'—è–∑–∫–∏

---

## üìä –°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –°—Ç–∞—Ä—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Å–∞–π—Ç—É

**–î–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó Telegram Login:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä–∏–≤ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –Ω–∞ —Å–∞–π—Ç—ñ ‚Üí `userId=null`
2. –ü–æ—Ç—ñ–º –ø—ñ–¥–∫–ª—é—á–∏–≤—Å—è –¥–æ –±–æ—Ç–∞ ‚Üí –æ–¥–∏–Ω –∑–∞–ø–∏—Å –æ—Ç—Ä–∏–º–∞–≤ `userId`
3. `/mybookings` –ø–æ–∫–∞–∑—É–≤–∞–≤ —Ç—ñ–ª—å–∫–∏ 1 –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

**–¢–µ–ø–µ—Ä:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–æ–Ω—É—î `/mybookings`
2. –ó–∞–ø–ª–∞—Ç–∫–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Å—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏
3. –û–Ω–æ–≤–ª—é—î —ó—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
4. –ü–æ–∫–∞–∑—É—î –í–°–Ü –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ –∞–Ω–æ–Ω—ñ–º–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä–∏–≤ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –≤ –∞–Ω–æ–Ω—ñ–º–Ω–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
2. –°—Ç–∞—Ä–∏–π –∫–æ–¥ –∫–æ–ø—ñ—é–≤–∞–≤ `userId='0'` –∑—ñ —Å—Ç–∞—Ä–∏—Ö –∑–∞–ø–∏—Å—ñ–≤
3. –ù–æ–≤—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —Ç–∞–∫–æ–∂ –º–∞–ª–∏ `userId='0'`

**–†—ñ—à–µ–Ω–Ω—è:**
1. Endpoint `/admin/fix-telegram-ids` –≤–∏–ø—Ä–∞–≤–∏–≤ —Å—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏
2. –ê–ª–µ –¥–µ—è–∫—ñ –º–æ–≥–ª–∏ –∑–∞–ª–∏—à–∏—Ç–∏—Å—è
3. `/mybookings` –¥–æ–æ—á–∏—Å—Ç–∏—Ç—å —Ä–µ—à—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

---

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –†—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –Ω–æ–º–µ—Ä—ñ–≤

**–°–∏—Ç—É–∞—Ü—ñ—è:**
- –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #1: `+380501234567`
- –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #2: `0501234567`
- –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #3: `380 50 123 45 67`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
–í—Å—ñ 3 –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é —ñ –ø—Ä–∏–≤'—è–∑—É—é—Ç—å—Å—è –¥–æ –æ–¥–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É —Å–∏—Ç—É–∞—Ü—ñ—é

**–í Railway Dashboard ‚Üí Database ‚Üí Query:**

```sql
-- –ó–Ω–∞–π—Ç–∏ —Å–≤—ñ–π userId
SELECT DISTINCT telegramUserId 
FROM Booking 
WHERE telegramUserId IS NOT NULL 
  AND telegramUserId != '0'
LIMIT 1;

-- –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ userId = 5072659044

-- –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ "—Å–∏—Ä—ñ—Ç—Å—å–∫–µ" –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
INSERT INTO Booking (route, date, departureTime, seats, name, phone, createdAt, updatedAt)
VALUES (
  'Kyiv-Malyn',
  '2026-02-10',
  '10:00',
  1,
  '–¢–µ—Å—Ç',
  '0501234567',  -- –¢–æ–π –∂–µ –Ω–æ–º–µ—Ä, —ñ–Ω—à–∏–π —Ñ–æ—Ä–º–∞—Ç
  NOW(),
  NOW()
);

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤–æ–Ω–æ –±–µ–∑ userId
SELECT id, phone, telegramUserId 
FROM Booking 
WHERE phone LIKE '%50123456%' 
  AND (telegramUserId IS NULL OR telegramUserId = '0')
ORDER BY createdAt DESC 
LIMIT 1;
```

---

### –ö—Ä–æ–∫ 2: –í–∏–∫–æ–Ω–∞—Ç–∏ /mybookings –≤ –±–æ—Ç—ñ

```
/mybookings
```

---

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ –Ω–∞ Railway

**Backend Service ‚Üí Logs ‚Üí —Ñ—ñ–ª—å—Ç—Ä "mybookings"**

–û—á—ñ–∫—É–≤–∞–Ω—ñ –ª–æ–≥–∏:
```
üîç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5072659044 –º–∞—î 3 –±—Ä–æ–Ω—é–≤–∞–Ω—å (–≤—Å—å–æ–≥–æ)
üîß –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —ñ–Ω—à—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ç–∞–∫–∏–º –∂–µ –Ω–æ–º–µ—Ä–æ–º –±–µ–∑ telegramUserId...
üì± –ù–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: +380501234567
üîß –ó–Ω–∞–π–¥–µ–Ω–æ 1 –±—Ä–æ–Ω—é–≤–∞–Ω—å –∑ –Ω–æ–º–µ—Ä–æ–º +380501234567 –±–µ–∑ telegramUserId
  ‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è #XX –æ–Ω–æ–≤–ª–µ–Ω–æ: userId=5072659044, chatId=5072659044
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–≤'—è–∑–∞–Ω–æ 1 —Å—Ç–∞—Ä–∏—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 5072659044
üìä –ü—ñ—Å–ª—è –∑–∞–ø–ª–∞—Ç–∫–∏: 4 –±—Ä–æ–Ω—é–≤–∞–Ω—å (+1)
```

---

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ë–î

```sql
SELECT id, phone, telegramUserId, telegramChatId 
FROM Booking 
WHERE phone LIKE '%50123456%' 
ORDER BY createdAt DESC;
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å—ñ –∑–∞–ø–∏—Å–∏ —Ç–µ–ø–µ—Ä –º–∞—é—Ç—å `telegramUserId = 5072659044` ‚úÖ

---

### –ö—Ä–æ–∫ 5: –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ /mybookings

```
/mybookings
```

**–û—á—ñ–∫—É–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**
```
üîç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5072659044 –º–∞—î 4 –±—Ä–æ–Ω—é–≤–∞–Ω—å (–≤—Å—å–æ–≥–æ)
üîß –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —ñ–Ω—à—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ç–∞–∫–∏–º –∂–µ –Ω–æ–º–µ—Ä–æ–º –±–µ–∑ telegramUserId...
üì± –ù–æ–º–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: +380501234567
// –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ - –≤—Å—ñ –≤–∂–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ ‚úÖ
üìÖ –ú–∞–π–±—É—Ç–Ω—ñ—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å: 4
```

**–Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∞!** –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –≤–∏–∫–ª–∏–∫ –Ω–µ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ–±–ª–µ–º.

---

## ‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

### –ß–∏ –Ω–µ –±—É–¥–µ –ø–æ–≤—ñ–ª—å–Ω–æ?

**–ù—ñ!** –ù–∞–≤—ñ—Ç—å —è–∫—â–æ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 100 –±—Ä–æ–Ω—é–≤–∞–Ω—å:

1. **–ü–µ—Ä—à–∏–π –≤–∏–∫–ª–∏–∫:** 
   - –ó–∞–ø–∏—Ç –¥–æ –ë–î: ~50ms
   - –û–Ω–æ–≤–ª–µ–Ω–Ω—è 10 –∑–∞–ø–∏—Å—ñ–≤: ~100ms
   - **–ó–∞–≥–∞–ª–æ–º:** ~200ms ‚úÖ

2. **–ù–∞—Å—Ç—É–ø–Ω—ñ –≤–∏–∫–ª–∏–∫–∏:**
   - –ó–∞–ø–∏—Ç –¥–æ –ë–î: ~50ms
   - –û–Ω–æ–≤–ª–µ–Ω—å –Ω–µ–º–∞—î (–≤–∂–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ)
   - **–ó–∞–≥–∞–ª–æ–º:** ~50ms ‚úÖ‚úÖ

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è:

```typescript
// –ó–∞–º—ñ—Å—Ç—å –æ–∫—Ä–µ–º–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
for (const phone of userPhones) {
  // –û–¥–∏–Ω –∑–∞–ø–∏—Ç –æ—Ç—Ä–∏–º—É—î –í–°–Ü "—Å–∏—Ä—ñ—Ç—Å—å–∫—ñ" –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
  const allBookingsForPhone = await prisma.booking.findMany({
    where: { OR: [{ telegramUserId: null }, ...] }
  });
  
  // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≤ –ø–∞–º º—è—Ç—ñ (—à–≤–∏–¥–∫–æ)
  const orphanedBookings = allBookingsForPhone.filter(...);
}
```

**–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:** O(n) –¥–µ n = –∫—ñ–ª—å–∫—ñ—Å—Ç—å "—Å–∏—Ä—ñ—Ç—Å—å–∫–∏—Ö" –±—Ä–æ–Ω—é–≤–∞–Ω—å (–∑–∞–∑–≤–∏—á–∞–π 0-10)

---

## üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞

### –©–æ —è–∫—â–æ –¥–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤–∏–π –Ω–æ–º–µ—Ä?

**–ù–µ–º–æ–∂–ª–∏–≤–æ!** –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–∞—Ä–∞–Ω—Ç—É—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å:
- `+380501234567` ‚Üí `380501234567`
- `0501234567` ‚Üí `380501234567`

–Ø–∫—â–æ –¥–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–∞—é—Ç—å **—Ä—ñ–∑–Ω—ñ** –Ω–æ–º–µ—Ä–∏ –∞–ª–µ —Å—Ö–æ–∂—ñ:
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A: `+380501234567`
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B: `+380501234568` (–æ—Å—Ç–∞–Ω–Ω—è —Ü–∏—Ñ—Ä–∞ 8)

‚Üí –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è: `380501234567` ‚â† `380501234568` ‚úÖ

---

### –©–æ —è–∫—â–æ –ø–æ–º–∏–ª–∫–æ–≤–æ –ø—Ä–∏–≤'—è–∑–∞—Ç–∏ —á—É–∂–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è?

**–ó–∞—Ö–∏—Å—Ç:**
```typescript
// –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ç—ñ–ª—å–∫–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –ó –¢–ò–ú –ñ–ï –ù–û–ú–ï–†–û–ú
const orphanedBookings = allBookingsForPhone.filter(b => 
  normalizePhone(b.phone) === normalizedPhone  // –¢–æ—á–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
);
```

–Ø–∫—â–æ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å –∑ –ø–µ–≤–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º ‚Üí –≤—ñ–Ω –Ω–µ –º–æ–∂–µ –ø—Ä–∏–≤'—è–∑–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑ —Ü–∏–º –Ω–æ–º–µ—Ä–æ–º.

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°–∫—ñ–ª—å–∫–∏ –±—Ä–æ–Ω—é–≤–∞–Ω—å –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ?

**–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–æ:** –í—Å—ñ —Å—Ç–∞—Ä—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –±–µ–∑ `telegramUserId`

**–ü—Ä–∞–∫—Ç–∏—á–Ω–æ:**
- –ü—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ `/mybookings` –≤—ñ–¥ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚Üí –≤—Å—ñ –π–æ–≥–æ —Å—Ç–∞—Ä—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ
- –ù–∞—Å—Ç—É–ø–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ ‚Üí 0 –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å (–≤–∂–µ –≥–æ—Ç–æ–≤–æ)

### –ü—Ä–∏–∫–ª–∞–¥ –¥–ª—è 100 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

1. **–î–µ–Ω—å 1:** 50 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤–∏–∫–ª–∏–∫–∞–ª–∏ `/mybookings`
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: 150 –±—Ä–æ–Ω—é–≤–∞–Ω—å (–≤ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É 3 –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)

2. **–î–µ–Ω—å 2:** –Ü–Ω—à—ñ 50 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤–∏–∫–ª–∏–∫–∞–ª–∏ `/mybookings`
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: 100 –±—Ä–æ–Ω—é–≤–∞–Ω—å

3. **–î–µ–Ω—å 3+:** –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–∂–µ –≤–∏–∫–ª–∏–∫–∞–ª–∏ `/mybookings`
   - –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: 0 –±—Ä–æ–Ω—é–≤–∞–Ω—å (–≤—Å–µ –≤–∂–µ —á–∏—Å—Ç–æ) ‚úÖ

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∑–∞–ø–ª–∞—Ç–∫–∞ –≤ `/mybookings` - —ñ–¥–µ–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è!** üéâ

### –ß–æ–º—É —Ü–µ –∫—Ä–∞—â–µ –∑–∞ –æ–∫—Ä–µ–º–∏–π endpoint?

| –ê—Å–ø–µ–∫—Ç | –û–∫—Ä–µ–º–∏–π endpoint | –ó–∞–ø–ª–∞—Ç–∫–∞ –≤ /mybookings |
|--------|------------------|------------------------|
| –ü–æ—Ç—Ä—ñ–±–µ–Ω admin token | ‚ùå –¢–∞–∫ | ‚úÖ –ù—ñ |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ—Å—Ç—å | ‚ùå –¢—Ä–µ–±–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –≤—Ä—É—á–Ω—É | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ |
| –î–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | ‚ùå –¢—ñ–ª—å–∫–∏ admin | ‚úÖ –î–ª—è –≤—Å—ñ—Ö |
| –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å | ‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –±–∞—á–∏—Ç—å | ‚úÖ –û–¥—Ä–∞–∑—É –±–∞—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
| –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å | ‚úÖ –¢–∞–∫ | ‚úÖ –¢–∞–∫ |
| –®–≤–∏–¥–∫—ñ—Å—Ç—å | ‚úÖ –®–≤–∏–¥–∫–æ | ‚úÖ –®–≤–∏–¥–∫–æ |

---

**–¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é —Å–∞–º–æ–≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞–ª—å–Ω–∞!** üöÄ

–ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É `/mybookings`:
1. ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–ª—è—î —Å—Ç–∞—Ä—ñ –∑–∞–ø–∏—Å–∏
3. ‚úÖ –ü–æ–∫–∞–∑—É—î –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫
4. ‚úÖ –õ–æ–≥—É—î –≤—Å–µ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–æ—Å—Ç–æ –±–∞—á–∏—Ç—å –≤—Å—ñ —Å–≤–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è - –∑–∞–≤–∂–¥–∏!** üéØ

---

**–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:** 28 —Å—ñ—á–Ω—è 2026  
**–ö–æ–º—ñ—Ç:** `411f3a6`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ —Ç–∞ –ø—Ä–∞—Ü—é—î
