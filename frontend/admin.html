<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å - –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      background: #f5f7fa; 
      color: #1f2937;
    }
    .header {
      background: #2563eb;
      color: white;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header h1 { font-size: 24px; }
    .header a {
      color: white;
      text-decoration: none;
      font-size: 14px;
      opacity: 0.9;
    }
    .header a:hover { opacity: 1; }
    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 20px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .stat-card h3 {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .stat-card .value {
      font-size: 32px;
      font-weight: bold;
      color: #2563eb;
    }
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      align-items: center;
    }
    .controls select,
    .controls input {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }
    .controls button {
      padding: 8px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .controls button:hover { background: #1d4ed8; }
    .controls button.secondary {
      background: #6b7280;
    }
    .controls button.secondary:hover { background: #4b5563; }
    .table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead {
      background: #f9fafb;
    }
    th {
      text-align: left;
      padding: 16px;
      font-weight: 600;
      font-size: 14px;
      color: #374151;
      border-bottom: 2px solid #e5e7eb;
    }
    td {
      padding: 16px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 14px;
    }
    tr:hover { background: #f9fafb; }
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge-kyiv-malyn {
      background: #dbeafe;
      color: #1e40af;
    }
    .badge-malyn-kyiv {
      background: #fef3c7;
      color: #92400e;
    }
    .badge-malyn-zhytomyr {
      background: #d1fae5;
      color: #065f46;
    }
    .badge-zhytomyr-malyn {
      background: #ede9fe;
      color: #5b21b6;
    }
    .btn-delete {
      padding: 6px 12px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    .btn-delete:hover { background: #dc2626; }
    .loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .empty {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .tab.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }
    .tab:hover {
      color: #2563eb;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .btn-edit {
      padding: 6px 12px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      margin-right: 8px;
    }
    .btn-edit:hover { background: #059669; }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h2 {
      font-size: 20px;
      color: #1f2937;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .close-btn:hover {
      color: #1f2937;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #374151;
    }
    .form-group select,
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    .btn-cancel {
      padding: 10px 20px;
      background: #e5e7eb;
      color: #374151;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-cancel:hover {
      background: #d1d5db;
    }
    .btn-save {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-save:hover {
      background: #1d4ed8;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìã –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å</h1>
    <a href="index.html">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</a>
  </div>

  <div class="container">
    <div id="error" class="error" style="display: none;"></div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('bookings')">üìã –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</button>
      <button class="tab" onclick="switchTab('schedules')">üïê –ì—Ä–∞—Ñ—ñ–∫–∏</button>
    </div>

    <!-- –°–µ–∫—Ü—ñ—è –±—Ä–æ–Ω—é–≤–∞–Ω—å -->
    <div id="bookingsTab" class="tab-content active">
      <div class="stats">
        <div class="stat-card">
          <h3>–í—Å—å–æ–≥–æ –±—Ä–æ–Ω—é–≤–∞–Ω—å</h3>
          <div class="value" id="totalBookings">0</div>
        </div>
        <div class="stat-card">
          <h3>–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω</h3>
          <div class="value" id="kyivMalyn">0</div>
        </div>
        <div class="stat-card">
          <h3>–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤</h3>
          <div class="value" id="malynKyiv">0</div>
        </div>
        <div class="stat-card">
          <h3>–ú–∞–ª–∏–Ω ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</h3>
          <div class="value" id="malynZhytomyr">0</div>
        </div>
        <div class="stat-card">
          <h3>–ñ–∏—Ç–æ–º–∏—Ä ‚Üí –ú–∞–ª–∏–Ω</h3>
          <div class="value" id="zhytomyrMalyn">0</div>
        </div>
        <div class="stat-card">
          <h3>–í—Å—å–æ–≥–æ –º—ñ—Å—Ü—å</h3>
          <div class="value" id="totalSeats">0</div>
        </div>
      </div>

      <div class="controls">
        <select id="filterRoute">
          <option value="">–í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏</option>
          <option value="Kyiv-Malyn-Irpin">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
          <option value="Malyn-Kyiv-Irpin">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
          <option value="Kyiv-Malyn-Bucha">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
          <option value="Malyn-Kyiv-Bucha">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
          <option value="Malyn-Zhytomyr">–ú–∞–ª–∏–Ω ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</option>
          <option value="Zhytomyr-Malyn">–ñ–∏—Ç–æ–º–∏—Ä ‚Üí –ú–∞–ª–∏–Ω</option>
        </select>
        <input type="date" id="filterDate" placeholder="–§—ñ–ª—å—Ç—Ä –ø–æ –¥–∞—Ç—ñ">
        <input type="text" id="searchInput" placeholder="–ü–æ—à—É–∫ –ø–æ —ñ–º–µ–Ω—ñ –∞–±–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É...">
        <button onclick="loadBookings()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        <button class="secondary" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
      </div>

      <div class="table-container">
        <div id="loading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div id="empty" class="empty" style="display: none;">
          <div class="empty-icon">üì≠</div>
          <div>–ù–µ–º–∞—î –±—Ä–æ–Ω—é–≤–∞–Ω—å</div>
        </div>
        <table id="bookingsTable" style="display: none;">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ú–∞—Ä—à—Ä—É—Ç</th>
              <th>–î–∞—Ç–∞</th>
              <th>–ß–∞—Å</th>
              <th>–ú—ñ—Å—Ü—è</th>
              <th>–Ü–º'—è</th>
              <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
              <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
              <th>–î—ñ—ó</th>
            </tr>
          </thead>
          <tbody id="bookingsBody"></tbody>
        </table>
      </div>
    </div>

    <!-- –°–µ–∫—Ü—ñ—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ -->
    <div id="schedulesTab" class="tab-content">
      <div class="controls">
        <select id="scheduleFilterRoute">
          <option value="">–í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏</option>
          <option value="Kyiv-Malyn-Irpin">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
          <option value="Malyn-Kyiv-Irpin">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
          <option value="Kyiv-Malyn-Bucha">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
          <option value="Malyn-Kyiv-Bucha">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
          <option value="Malyn-Zhytomyr">–ú–∞–ª–∏–Ω ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</option>
          <option value="Zhytomyr-Malyn">–ñ–∏—Ç–æ–º–∏—Ä ‚Üí –ú–∞–ª–∏–Ω</option>
        </select>
        <button onclick="loadSchedules()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        <button onclick="openScheduleModal()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä–µ–π—Å</button>
      </div>

      <div class="table-container">
        <div id="schedulesLoading" class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        <div id="schedulesEmpty" class="empty" style="display: none;">
          <div class="empty-icon">üïê</div>
          <div>–ù–µ–º–∞—î –≥—Ä–∞—Ñ—ñ–∫—ñ–≤</div>
        </div>
        <table id="schedulesTable" style="display: none;">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ú–∞—Ä—à—Ä—É—Ç</th>
              <th>–ß–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è</th>
              <th>–ú–∞–∫—Å. –º—ñ—Å—Ü—å</th>
              <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
              <th>–û–Ω–æ–≤–ª–µ–Ω–æ</th>
              <th>–î—ñ—ó</th>
            </tr>
          </thead>
          <tbody id="schedulesBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">–î–æ–¥–∞—Ç–∏ —Ä–µ–π—Å</h2>
        <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
      </div>
      <form id="scheduleForm" onsubmit="saveSchedule(event)">
        <div class="form-group">
          <label>–ú–∞—Ä—à—Ä—É—Ç *</label>
          <select id="modalRoute" required>
            <option value="">–û–±–µ—Ä—ñ—Ç—å –º–∞—Ä—à—Ä—É—Ç</option>
            <option value="Kyiv-Malyn-Irpin">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
            <option value="Malyn-Kyiv-Irpin">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)</option>
            <option value="Kyiv-Malyn-Bucha">–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
            <option value="Malyn-Kyiv-Bucha">–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –ë—É—á—É)</option>
            <option value="Malyn-Zhytomyr">–ú–∞–ª–∏–Ω ‚Üí –ñ–∏—Ç–æ–º–∏—Ä</option>
            <option value="Zhytomyr-Malyn">–ñ–∏—Ç–æ–º–∏—Ä ‚Üí –ú–∞–ª–∏–Ω</option>
          </select>
        </div>
        <div class="form-group">
          <label>–ß–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è * (—Ñ–æ—Ä–º–∞—Ç HH:MM)</label>
          <input type="text" id="modalDepartureTime" placeholder="08:00" required pattern="^([0-1][0-9]|2[0-3]):[0-5][0-9]$">
        </div>
        <div class="form-group">
          <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å *</label>
          <input type="number" id="modalMaxSeats" placeholder="20" min="1" max="100" required>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeScheduleModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          <button type="submit" class="btn-save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000';
    let allBookings = [];
    let allSchedules = [];
    let editingScheduleId = null;

    // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
    function getRouteLabel(route) {
      const routes = {
        'Kyiv-Malyn-Irpin': '–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)',
        'Malyn-Kyiv-Irpin': '–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –Ü—Ä–ø—ñ–Ω—å)',
        'Kyiv-Malyn-Bucha': '–ö–∏—ó–≤ ‚Üí –ú–∞–ª–∏–Ω (—á–µ—Ä–µ–∑ –ë—É—á—É)',
        'Malyn-Kyiv-Bucha': '–ú–∞–ª–∏–Ω ‚Üí –ö–∏—ó–≤ (—á–µ—Ä–µ–∑ –ë—É—á—É)',
        'Malyn-Zhytomyr': '–ú–∞–ª–∏–Ω ‚Üí –ñ–∏—Ç–æ–º–∏—Ä',
        'Zhytomyr-Malyn': '–ñ–∏—Ç–æ–º–∏—Ä ‚Üí –ú–∞–ª–∏–Ω'
      };
      return routes[route] || route;
    }

    function getRouteBadgeClass(route) {
      if (route.includes('Kyiv-Malyn')) return 'badge-kyiv-malyn';
      if (route.includes('Malyn-Kyiv')) return 'badge-malyn-kyiv';
      if (route.includes('Malyn-Zhytomyr')) return 'badge-malyn-zhytomyr';
      if (route.includes('Zhytomyr-Malyn')) return 'badge-zhytomyr-malyn';
      return 'badge-kyiv-malyn';
    }

    // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–∞–±—ñ–≤
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      if (tabName === 'bookings') {
        document.querySelector('.tab[onclick="switchTab(\'bookings\')"]').classList.add('active');
        document.getElementById('bookingsTab').classList.add('active');
      } else {
        document.querySelector('.tab[onclick="switchTab(\'schedules\')"]').classList.add('active');
        document.getElementById('schedulesTab').classList.add('active');
        loadSchedules();
      }
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω—å
    async function loadBookings() {
      const loading = document.getElementById('loading');
      const table = document.getElementById('bookingsTable');
      const empty = document.getElementById('empty');
      const error = document.getElementById('error');
      
      loading.style.display = 'block';
      table.style.display = 'none';
      empty.style.display = 'none';
      error.style.display = 'none';

      try {
        const res = await fetch(`${API_URL}/bookings`);
        if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
        
        allBookings = await res.json();
        applyFilters();
      } catch (err) {
        error.textContent = `–ü–æ–º–∏–ª–∫–∞: ${err.message}`;
        error.style.display = 'block';
      } finally {
        loading.style.display = 'none';
      }
    }

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
    function applyFilters() {
      const routeFilter = document.getElementById('filterRoute').value;
      const dateFilter = document.getElementById('filterDate').value;
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();

      let filtered = allBookings.filter(booking => {
        if (routeFilter && booking.route !== routeFilter) return false;
        if (dateFilter) {
          const bookingDate = new Date(booking.date).toISOString().split('T')[0];
          if (bookingDate !== dateFilter) return false;
        }
        if (searchQuery) {
          const searchIn = `${booking.name} ${booking.phone}`.toLowerCase();
          if (!searchIn.includes(searchQuery)) return false;
        }
        return true;
      });

      displayBookings(filtered);
      updateStats(filtered);
    }

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω—å
    function displayBookings(bookings) {
      const tbody = document.getElementById('bookingsBody');
      const table = document.getElementById('bookingsTable');
      const empty = document.getElementById('empty');

      if (bookings.length === 0) {
        table.style.display = 'none';
        empty.style.display = 'block';
        return;
      }

      table.style.display = 'table';
      empty.style.display = 'none';

      tbody.innerHTML = bookings.map(booking => {
        const date = new Date(booking.date);
        const createdAt = new Date(booking.createdAt);
        const routeLabel = getRouteLabel(booking.route);
        const badgeClass = getRouteBadgeClass(booking.route);

        return `
          <tr>
            <td>#${booking.id}</td>
            <td><span class="badge ${badgeClass}">${routeLabel}</span></td>
            <td>${date.toLocaleDateString('uk-UA')}</td>
            <td><strong>${booking.departureTime}</strong></td>
            <td>${booking.seats}</td>
            <td>${booking.name}</td>
            <td>${booking.phone}</td>
            <td>${createdAt.toLocaleString('uk-UA')}</td>
            <td>
              <button class="btn-delete" onclick="deleteBooking(${booking.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStats(bookings) {
      document.getElementById('totalBookings').textContent = bookings.length;
      document.getElementById('kyivMalyn').textContent =
        bookings.filter(b => b.route.includes('Kyiv-Malyn')).length;
      document.getElementById('malynKyiv').textContent =
        bookings.filter(b => b.route.includes('Malyn-Kyiv')).length;
      document.getElementById('malynZhytomyr').textContent =
        bookings.filter(b => b.route.includes('Malyn-Zhytomyr')).length;
      document.getElementById('zhytomyrMalyn').textContent =
        bookings.filter(b => b.route.includes('Zhytomyr-Malyn')).length;
      document.getElementById('totalSeats').textContent =
        bookings.reduce((sum, b) => sum + b.seats, 0);
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
    async function deleteBooking(id) {
      if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è?')) return;

      try {
        const res = await fetch(`${API_URL}/bookings/${id}`, {
          method: 'DELETE'
        });

        if (res.ok || res.status === 204) {
          loadBookings();
        } else {
          const error = await res.json();
          alert(`–ü–æ–º–∏–ª–∫–∞: ${error.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è'}`);
        }
      } catch (err) {
        alert(`–ü–æ–º–∏–ª–∫–∞: ${err.message}`);
      }
    }

    // –û—á–∏—â–µ–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
    function clearFilters() {
      document.getElementById('filterRoute').value = '';
      document.getElementById('filterDate').value = '';
      document.getElementById('searchInput').value = '';
      applyFilters();
    }

    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
    document.getElementById('filterRoute').addEventListener('change', applyFilters);
    document.getElementById('filterDate').addEventListener('change', applyFilters);
    document.getElementById('searchInput').addEventListener('input', applyFilters);

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    async function loadSchedules() {
      const loading = document.getElementById('schedulesLoading');
      const table = document.getElementById('schedulesTable');
      const empty = document.getElementById('schedulesEmpty');
      const error = document.getElementById('error');
      
      loading.style.display = 'block';
      table.style.display = 'none';
      empty.style.display = 'none';
      error.style.display = 'none';

      try {
        const routeFilter = document.getElementById('scheduleFilterRoute').value;
        const url = routeFilter ? `${API_URL}/schedules?route=${routeFilter}` : `${API_URL}/schedules`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
        
        allSchedules = await res.json();
        displaySchedules(allSchedules);
      } catch (err) {
        error.textContent = `–ü–æ–º–∏–ª–∫–∞: ${err.message}`;
        error.style.display = 'block';
      } finally {
        loading.style.display = 'none';
      }
    }

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    function displaySchedules(schedules) {
      const tbody = document.getElementById('schedulesBody');
      const table = document.getElementById('schedulesTable');
      const empty = document.getElementById('schedulesEmpty');

      if (schedules.length === 0) {
        table.style.display = 'none';
        empty.style.display = 'block';
        return;
      }

      // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è: —Å–ø–æ—á–∞—Ç–∫—É –ø–æ –º–∞—Ä—à—Ä—É—Ç—É, –ø–æ—Ç—ñ–º –ø–æ —á–∞—Å—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
      const sortedSchedules = [...schedules].sort((a, b) => {
        // –°–ø–æ—á–∞—Ç–∫—É —Å–æ—Ä—Ç—É—î–º–æ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
        if (a.route !== b.route) {
          return a.route.localeCompare(b.route);
        }
        // –Ø–∫—â–æ –º–∞—Ä—à—Ä—É—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ, —Å–æ—Ä—Ç—É—î–º–æ –ø–æ —á–∞—Å—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
        return a.departureTime.localeCompare(b.departureTime);
      });

      table.style.display = 'table';
      empty.style.display = 'none';

      tbody.innerHTML = sortedSchedules.map(schedule => {
        const createdAt = new Date(schedule.createdAt);
        const updatedAt = new Date(schedule.updatedAt);
        const routeLabel = getRouteLabel(schedule.route);
        const badgeClass = getRouteBadgeClass(schedule.route);

        return `
          <tr>
            <td>#${schedule.id}</td>
            <td><span class="badge ${badgeClass}">${routeLabel}</span></td>
            <td><strong>${schedule.departureTime}</strong></td>
            <td><strong>${schedule.maxSeats || 20}</strong></td>
            <td>${createdAt.toLocaleString('uk-UA')}</td>
            <td>${updatedAt.toLocaleString('uk-UA')}</td>
            <td>
              <button class="btn-edit" onclick="editSchedule(${schedule.id})">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
              <button class="btn-delete" onclick="deleteSchedule(${schedule.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
    function openScheduleModal() {
      editingScheduleId = null;
      document.getElementById('modalTitle').textContent = '–î–æ–¥–∞—Ç–∏ —Ä–µ–π—Å';
      document.getElementById('scheduleForm').reset();
      document.getElementById('scheduleModal').classList.add('active');
    }

    // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
    function editSchedule(id) {
      const schedule = allSchedules.find(s => s.id === id);
      if (!schedule) return;

      editingScheduleId = id;
      document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ä–µ–π—Å';
      document.getElementById('modalRoute').value = schedule.route;
      document.getElementById('modalDepartureTime').value = schedule.departureTime;
      document.getElementById('modalMaxSeats').value = schedule.maxSeats || 20;
      document.getElementById('scheduleModal').classList.add('active');
    }

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
    function closeScheduleModal() {
      document.getElementById('scheduleModal').classList.remove('active');
      editingScheduleId = null;
      document.getElementById('scheduleForm').reset();
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É
    async function saveSchedule(event) {
      event.preventDefault();
      const route = document.getElementById('modalRoute').value;
      const departureTime = document.getElementById('modalDepartureTime').value;
      const maxSeats = document.getElementById('modalMaxSeats').value;

      if (!route || !departureTime || !maxSeats) {
        alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
        return;
      }

      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É —á–∞—Å—É
      const timeRegex = /^([0-1][0-9]|2[0-3]):[0-5][0-9]$/;
      if (!timeRegex.test(departureTime)) {
        alert('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —á–∞—Å—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HH:MM (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 08:00)');
        return;
      }

      if (Number(maxSeats) < 1 || Number(maxSeats) > 100) {
        alert('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤—ñ–¥ 1 –¥–æ 100');
        return;
      }

      try {
        const url = editingScheduleId 
          ? `${API_URL}/schedules/${editingScheduleId}`
          : `${API_URL}/schedules`;
        const method = editingScheduleId ? 'PUT' : 'POST';

        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ route, departureTime, maxSeats: Number(maxSeats) })
        });

        if (res.ok) {
          closeScheduleModal();
          loadSchedules();
        } else {
          const error = await res.json();
          alert(`–ü–æ–º–∏–ª–∫–∞: ${error.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫'}`);
        }
      } catch (err) {
        alert(`–ü–æ–º–∏–ª–∫–∞: ${err.message}`);
      }
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É
    async function deleteSchedule(id) {
      if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ä–µ–π—Å?')) return;

      try {
        const res = await fetch(`${API_URL}/schedules/${id}`, {
          method: 'DELETE'
        });

        if (res.ok || res.status === 204) {
          loadSchedules();
        } else {
          const error = await res.json();
          alert(`–ü–æ–º–∏–ª–∫–∞: ${error.error || '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫'}`);
        }
      } catch (err) {
        alert(`–ü–æ–º–∏–ª–∫–∞: ${err.message}`);
      }
    }

    // –û–±—Ä–æ–±–Ω–∏–∫ —Ñ—ñ–ª—å—Ç—Ä–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    document.getElementById('scheduleFilterRoute').addEventListener('change', loadSchedules);

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
    document.getElementById('scheduleModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeScheduleModal();
      }
    });

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
    loadBookings();
  </script>
</body>
</html>
